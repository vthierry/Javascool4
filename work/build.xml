<!-- Construction des éléments de javascool (core), javascoolbuilder, et des proglets -->
<project>
  <!-- On utilise http://ant-contrib.sourceforge.net/tasks/tasks/index.html pour un meilleur interface -->
  <taskdef resource="net/sf/antcontrib/antlib.xml"/>

  <property name="classpath" value="lib/RSyntaxTextArea.jar:lib/jvs2html.jar"/>

  <target name="classes">
    <!--delete dir="../build/classes"/-->
    <mkdir dir="../build/classes"/>
    <javac deprecation="true" debug="true" debuglevel="lines,vars,source" classpath="${classpath}" srcdir="src" destdir="../build/classes"/>
  </target>
  
  <target name="javascool.jar" depends="classes" >
    <mkdir dir="../build"/>
    <delete file="../build/javascool.jar"/>
    <unzip dest="../build/classes" src="lib/RSyntaxTextArea.jar"/>
    <unzip dest="../build/classes" src="lib/javac.jar"/>
    <jar destfile="../build/javascool.jar">
      <manifest>
        <attribute name="Main-Class" value="org.javascool.Core"/>
      </manifest>
      <fileset dir="../build/classes"/>
      <fileset dir="src" includes="org/javascool/widgets/icons/*"/>
    </jar>
    <exec executable="sh">
      <arg value="-c"/>
      <arg value="ls -l ../build/javascool.jar"/>
    </exec>
  </target>

  <target name="javascool-builder.jar" depends="classes" >
    <mkdir dir="../build"/>
    <delete file="../build/javascool-builder.jar"/>
    <unzip dest="../build/classes" src="lib/RSyntaxTextArea.jar"/>
    <unzip dest="../build/classes" src="lib/javac.jar"/>
    <unzip dest="../build/classes" src="lib/jvs2html.jar"/>
    <unzip dest="../build/classes" src="lib/saxon.jar"/>
    <jar destfile="../build/javascool-builder.jar">
      <manifest>
        <attribute name="Main-Class" value="org.javascool.Build"/>
      </manifest>
      <fileset dir="../build/classes"/>
      <fileset dir="src" includes="org/javascool/widgets/icons/*"/>
      <fileset dir="src" includes="org/javascool/builder/*.xslt"/>
    </jar>
    <exec executable="sh">
      <arg value="-c"/>
      <arg value="ls -l ../build/javascool-builder.jar"/>
    </exec>
  </target>

  <target name="javadoc">
    <mkdir dir="../build/web/api"/>
    <javadoc
      verbose="false"
      classpath="${classpath}"
      access="public" 
      destdir="../build/web/api"
      windowtitle="Java's Cool v4"
      doctitle="Java's Cool v4"
      author="true"
      version="true"
      nodeprecated="true"
      nohelp="true"
      nonavbar="true"
      notree="true"
      charset="UTF-8"
       >
      <link href="http://download.oracle.com/javase/6/docs/api"/>
      <link href="http://javadoc.fifesoft.com/rsyntaxtextarea"/>
      <fileset dir="src" defaultexcludes="yes">
        <include name="**/*.java"/>
      </fileset>
    </javadoc>
    <copy todir="../build/web/api">        
      <fileset dir="src">
        <include name="**/*.java"/>
      </fileset>
      <mapper type="glob" from="*" to="*.java"/>
    </copy>
    <java jar="lib/java2html.jar" fork="true">
      <arg value="-srcdir"/>
      <arg value="../build/web/api"/>
      <!-- [-filemask *.java] [-converter html | xhtml11 | xhtml | tex | rtf | xml] [-tabs 4] [-copytotargetunprocessedfiles] -style [ Eclipse | Kawa | Monochrome ] -->
    </java>
  </target>

  <target name="run" depends="javascool.jar">
    <java jar="../build/javascool.jar" dir="../sketchbook" fork="true"/>
  </target>
  
  <target name="brun" depends="javascool-builder.jar">
    <java jar="../build/javascool-builder.jar" dir="../sketchbook" fork="true">
      <arg value="-q"/>
    </java>
  </target>
  
  <target name="clean">
    <delete dir="../build/classes"/>
    <delete dir="../build/web/api"/>
    <delete dir="src/web/.http.root"/>
    <delete dir="nbproject/private"/>
  </target>
    
</project>
